<%#
+++
date = "2017-08-10T18:04:51Z"
draft = false
title = "git pullか、rebaseか。コミット管理のベストプラクティス！"
categories = ["git"]
+++
%>

リモートから最新を取得するときのpull・・・。

リモートにpushするときのrebase・・・。

`git pull`するか・・`git pull --rebase`するか・・`git rebase`するか・・といった議論の自分なりの見解

******


### 0. 前提

- 開発単位、レビュー単位は小さくまとめること。
- この考えでチームが動けばそもそもコンフリクトなんてそんなに遭遇しない。

******


### 1. 作業内容を仮コミット, push

```
# 日々の仮コミットがすでにある場合の手順。仮コミットを１つにまとめるため。
# 直前のコミットを取り消し、変更点をインデックスにもどす
git reset --soft HEAD^

# pオプションは常識
git add -p
git commit -m "日々の仮コミット"
# -fの扱いは気をつけるように。
git push -f origin tmp1
```

- 日々の仮コミットがすでにある場合はまとめる！`仮コミットは１つ！`
- ローカルが死んでしまったら困るのは自分。頻繁にリモートにpushして退避する！
- どうせあとで修正するので中途半端だろうがなんだろうがpushする。

******


### 2. リモートを取り込む

```
git fetch --prune
git rebase remotes/origin/master

# 以下、コンフリクト発生時の手順。コンフリクトしないときは不要
vi {競合ファイル}
git add -p {競合ファイル}
git rebase --continue
```

- 必ず`取り込む前に1.の仮コミット`を済ませておくこと。また、それは`直前`でなければならない！
  - 自分の仮コミットが最新コミットじゃないと、rebaseをした時、他のコミットハッシュも変わってしまう！
- `rebase`を使い、コンフリクト発生時の`マージコミットを残さない`のがベストプラクティス！
  - もちろんコンフリクト発生時はpull同様、修正する必要がある
- このリモート取り込みは頻繁に。`１日最低２回（朝と夜）`は行うこと。１度に解消するコンフリクトが少なくてすむ。
- 取り込みブランチはマスターに限らず。リモートブランチに限らず。

******


### 3. リモートに正式pushする

- `1. 2. の作業を行うだけ！`
- 複数コミットに分けたい場合はよしなにだが、都度正式pushしていればおかしなことにならないはず
- １度レビューを受けたあとにrebaseすると、レビュー者が分からなくなってしまうので控えたほうがよい。もしくはrebaseしたことを伝えること。
